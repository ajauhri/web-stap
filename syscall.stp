#! /usr/bin/env stap
# syscall.stp : system calls made by each process
# output format: [executable of target process | process id | parent process id | time in sec since epoch | syscall name | syscall time 


global syscalls_count

probe syscall.* {
  syscalls_count[execname(), pid(), ppid(), gettimeofday_s(), name]++
}

function print_syscalls () {
  foreach ([exec, pid, ppid, ctime, name] in syscalls_count-) {
    printf("%-15s %5d %5d %lu %25s %10d \n", exec, pid, ppid, ctime, name, syscalls_count[exec, pid, ppid, ctime, name]) 
  }
  delete syscalls_count
}

probe timer.s(1) {
  print_syscalls()
}
